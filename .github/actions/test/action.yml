# https://docs.github.com/en/actions/creating-actions/creating-a-composite-action
name: "Docker tests version scoped"
description: "Custom test action to test each individual API version isolated in docker"
# these inputs are always provided by flowzone, so they must always be defined on the composite action
inputs:
  json:
    description: "JSON stringified object containing all the inputs from the calling workflow"
    required: true
  secrets:
    description: "JSON stringified object containing all the secrets from the calling workflow"
    required: true

runs:
  using: "composite"
  steps:
    - name: Run isolated tests for version ${{ env.matrix_value }}
      shell: bash
      if: ${{ env.matrix_value != '' }}
      run: |
        ARGV_BASE_DIRECTORY=$(pwd)
        ARGV_GO_PKG=github.com/docker/docker

        mkdir -p "/go/src/${ARGV_GO_PKG}"
        cp -Lr "${ARGV_BASE_DIRECTORY}/." "/go/src/${ARGV_GO_PKG}/"
        pushd "/go/src/${ARGV_GO_PKG}" >/dev/null

        hack/dind hack/test/unit
